<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Manager</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            // Function to load all tasks using a GET request
            loadTasks();

            function loadTasks() {
                $.ajax({
                    url: "http://localhost:8080/main",
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        let taskList = $('#taskList');
                        taskList.empty(); // Clear list before adding new tasks
                        $.each(data, function (index, task) {
                            console.log(task.name); // Check that task actually contains data
                            taskList.append(
                                `<li id="task-${task.id}">
                                    <span>${task.name}</span> -
                                    <span>${task.description}</span> -
                                    <span>${task.deadline}</span> -
                                    <span>${task.status}</span>
                                    <button onclick="deleteTask(${task.id})">Delete</button>
                                    <button onclick="showEditTask(${task.id}, '${task.name}', '${task.description}', '${task.deadline}', '${task.status}')">Edit</button>
                                </li>`
                            );
                        });
                    },
                    error: function (err) {
                        alert("Error loading tasks");
                    }
                });
            }

            // Adding a new task using a POST request
            $('#addTaskForm').submit(function (e) {
                e.preventDefault();
                let name = $('#name').val();
                let description = $('#description').val();
                let deadline = $('#deadline').val();
                let status = $('#status').val();
                $.ajax({
                    url: "http://localhost:8080/main",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ name: name, description: description, deadline: deadline, status: status }),
                    success: function () {
                        loadTasks();
                        $('#name').val('');
                        $('#description').val('');
                        $('#deadline').val('');
                        $('#status').val('');
                    },
                    error: function (err) {
                        alert("Error adding task");
                    }
                });
            });

            // Updating a task using a PUT request
            $('#editTaskForm').submit(function (e) {
                e.preventDefault();
                let taskId = $('#editTaskId').val();
                let name = $('#editName').val();
                let description = $('#editDescription').val();
                let deadline = $('#editDeadline').val();
                let status = $('#editStatus').val();
                $.ajax({
                    url: `http://localhost:8080/main/${taskId}`,
                    type: "PUT",
                    contentType: "application/json",
                    data: JSON.stringify({ name: name, description: description, deadline: deadline, status: status }),
                    success: function () {
                        loadTasks();
                        $('#editTaskModal').hide();
                    },
                    error: function (err) {
                        alert("Error updating task");
                    }
                });
            });

            // Deleting a task using a DELETE request
            window.deleteTask = function (taskId) {
                $.ajax({
                    url: `http://localhost:8080/main/${taskId}`,
                    type: "DELETE",
                    success: function () {
                        loadTasks();
                    },
                    error: function (err) {
                        alert("Error deleting task");
                    }
                });
            };

            // Showing the edit task form
            window.showEditTask = function (taskId, name, description, deadline, status) {
                $('#editTaskId').val(taskId);
                $('#editName').val(name);
                $('#editDescription').val(description);
                $('#editDeadline').val(deadline);
                $('#editStatus').val(status);
                $('#editTaskModal').show();
            };

            // Hiding the edit task form
            $('#editTaskModalClose').click(function () {
                $('#editTaskModal').hide();
            });
        });
    </script>
</head>
<body>
<h1>Task Manager</h1>
<h2>Add a New Task</h2>
<form id="addTaskForm">
    <label for="name">Task Name:</label>
    <input type="text" id="name" name="name" required>
    <label for="description">Task Description:</label>
    <input type="text" id="description" name="description" required>
    <label for="deadline">Task Deadline:</label>
    <input type="datetime-local" id="deadline" name="deadline" required>
    <label for="status">Status:</label>
    <input type="text" id="status" name="status" required>
    <button type="submit">Add Task</button>
</form>
<h2>Task List</h2>
<ul id="taskList">
    <!-- Tasks will be loaded here dynamically -->
</ul>
<!-- Edit Task Modal -->
<div id="editTaskModal" style="display:none;">
    <h2>Edit Task</h2>
    <form id="editTaskForm">
        <input type="hidden" id="editTaskId" name="taskId">
        <label for="editName">Task Name:</label>
        <input type="text" id="editName" name="name" required>
        <label for="editDescription">Task Description:</label>
        <input type="text" id="editDescription" name="description" required>
        <label for="editDeadline">Task Deadline:</label>
        <input type="datetime-local" id="editDeadline" name="deadline" required>
        <label for="editStatus">Status:</label>
        <input type="text" id="editStatus" name="status" required>
        <button type="submit">Save Changes</button>
    </form>
    <button id="editTaskModalClose">Close</button>
</div>
</body>
</html>
